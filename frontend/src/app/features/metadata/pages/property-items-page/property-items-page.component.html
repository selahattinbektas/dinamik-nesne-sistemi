<section>
  <h2>Property Item Yönetimi</h2>
  <div class="form-grid" style="margin-top: 12px;">
    <label class="form-field">
      Metadata Adı
      <input type="text" [value]="metaDataName" disabled />
    </label>
    <label class="form-field">
      Entity Type
      <input type="text" [value]="metaDataEntityType" disabled />
    </label>
  </div>
</section>

<form [formGroup]="form" (ngSubmit)="submit()" style="margin-top: 24px;">
  <h3 class="section-title" style="font-size: 16px;">Property Item Bilgileri</h3>
  <div class="form-grid" style="margin-top: 12px;">
    <label class="form-field">
      Item Name
      <input type="text" formControlName="itemName" placeholder="propertyKey" />
    </label>

    <label class="form-field">
      Başlık
      <input type="text" formControlName="title" placeholder="Başlık" />
    </label>

    <label class="form-field">
      Component Type
      <select formControlName="type">
          <option *ngFor="let type of componentTypes" [value]="type">
              {{ componentTypeLabels[type] }}
          </option>
      </select>
    </label>

      <label class="form-field" *ngIf="isOptionType(form.get('type')?.value)">
      Options
      <select formControlName="options" multiple>
        <option *ngFor="let option of options" [ngValue]="option">
          {{ option.label }}
        </option>
      </select>
    </label>

    <label class="form-field">
      Property Item Type
      <select formControlName="propertyItemType">
        <option *ngFor="let type of propertyItemTypes" [value]="type">{{ type }}</option>
      </select>
    </label>

    <label class="form-field">
      Unit
      <input type="text" formControlName="unit" placeholder="kg, cm, vb." />
    </label>

    <label class="form-field">
      Default Value
      <input type="text" formControlName="defaultValue" placeholder="Varsayılan değer" />
    </label>

    <label class="form-field">
      Min
      <input type="number" formControlName="min" />
    </label>

    <label class="form-field">
      Max
      <input type="number" formControlName="max" />
    </label>

    <label class="form-field">
      To Validator Class
      <input type="text" formControlName="toValidatorClass" placeholder="Validator class" />
    </label>

    <label class="form-field">
      From Validator Class
      <input type="text" formControlName="fromValidatorClass" placeholder="Validator class" />
    </label>
  </div>

  <div style="margin-top: 12px; display: flex; flex-wrap: wrap; gap: 16px;">
    <label class="form-field" style="display: flex; align-items: center; gap: 8px;">
      <input type="checkbox" formControlName="groupProperty" />
      Group Property
    </label>
    <label class="form-field" style="display: flex; align-items: center; gap: 8px;">
      <input type="checkbox" formControlName="readOnly" />
      Read Only
    </label>
    <label class="form-field" style="display: flex; align-items: center; gap: 8px;">
      <input type="checkbox" formControlName="showContextMenu" />
      Show Context Menu
    </label>
    <label class="form-field" style="display: flex; align-items: center; gap: 8px;">
      <input type="checkbox" formControlName="selectedVisible" />
      Selected Visible
    </label>
  </div>

  <div style="margin-top: 16px; display: flex; gap: 12px;">
    <button type="submit" [disabled]="isSaving">Kaydet</button>
  </div>
</form>

<p *ngIf="errorMessage" style="margin-top: 12px; color: #dc2626;">{{ errorMessage }}</p>
<p *ngIf="isLoading" style="margin-top: 12px;">Yükleniyor...</p>

<table class="table" *ngIf="propertyItems.length">
  <thead>
    <tr>
      <th>Item Name</th>
      <th>Title</th>
      <th>Type</th>
      <th>Property Item Type</th>
      <th>Unit</th>
      <th>Min</th>
      <th>Max</th>
      <th>Default</th>
      <th>Flags</th>
      <th>İşlemler</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of propertyItems">
      <td>{{ item.itemName }}</td>
      <td>{{ item.title }}</td>
      <td><span class="badge">{{ item.type }}</span></td>
      <td><span class="badge">{{ item.propertyItemType }}</span></td>
      <td>{{ item.unit || '-' }}</td>
      <td>{{ item.min ?? '-' }}</td>
      <td>{{ item.max ?? '-' }}</td>
      <td>{{ item.defaultValue || '-' }}</td>
      <td>
        <span *ngIf="item.groupProperty">Group</span>
        <span *ngIf="item.readOnly">ReadOnly</span>
        <span *ngIf="item.showContextMenu">Context</span>
        <span *ngIf="item.selectedVisible">Visible</span>
      </td>
      <td>
        <div class="table-actions">
          <button type="button" class="secondary" (click)="openEditDialog(item)" [disabled]="isLoading">
            Güncelle
          </button>
          <button type="button" class="danger" (click)="deletePropertyItem(item)" [disabled]="isLoading">
            Sil
          </button>
        </div>
      </td>
    </tr>
  </tbody>
</table>

<app-empty-state
  *ngIf="!propertyItems.length && !isLoading"
  message="Henüz property item kaydı yok."
></app-empty-state>

<div class="modal-backdrop" *ngIf="isEditDialogOpen">
  <div class="modal">
    <h3 class="modal-title">Property Item Güncelle</h3>
    <form [formGroup]="editForm" (ngSubmit)="updatePropertyItem()">
      <div class="form-grid">
        <label class="form-field">
          Item Name
          <input type="text" formControlName="itemName" />
        </label>
        <label class="form-field">
          Başlık
          <input type="text" formControlName="title" />
        </label>
        <label class="form-field">
          Component Type
          <select formControlName="type">
              <option *ngFor="let type of componentTypes" [value]="type">
                  {{ componentTypeLabels[type] }}
              </option>
          </select>
        </label>

          <label class="form-field" *ngIf="isOptionType(editForm.get('type')?.value)">
          Options
          <select formControlName="options" multiple>
            <option *ngFor="let option of options" [ngValue]="option">
              {{ option.label }}
            </option>
          </select>
        </label>
        <label class="form-field">
          Property Item Type
          <select formControlName="propertyItemType">
            <option *ngFor="let type of propertyItemTypes" [value]="type">{{ type }}</option>
          </select>
        </label>
        <label class="form-field">
          Unit
          <input type="text" formControlName="unit" />
        </label>
        <label class="form-field">
          Default Value
          <input type="text" formControlName="defaultValue" />
        </label>
        <label class="form-field">
          Min
          <input type="number" formControlName="min" />
        </label>
        <label class="form-field">
          Max
          <input type="number" formControlName="max" />
        </label>
        <label class="form-field">
          To Validator Class
          <input type="text" formControlName="toValidatorClass" />
        </label>
        <label class="form-field">
          From Validator Class
          <input type="text" formControlName="fromValidatorClass" />
        </label>
      </div>

      <div style="margin-top: 12px; display: flex; flex-wrap: wrap; gap: 16px;">
        <label class="form-field" style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" formControlName="groupProperty" />
          Group Property
        </label>
        <label class="form-field" style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" formControlName="readOnly" />
          Read Only
        </label>
        <label class="form-field" style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" formControlName="showContextMenu" />
          Show Context Menu
        </label>
        <label class="form-field" style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" formControlName="selectedVisible" />
          Selected Visible
        </label>
      </div>

      <div class="modal-actions">
        <button type="button" class="secondary" (click)="closeEditDialog()">Vazgeç</button>
        <button type="submit" [disabled]="isSaving">Güncelle</button>
      </div>
    </form>
  </div>
</div>
